(()=>{var u=e=>document.querySelector(e),E=e=>document.querySelectorAll(e),N="#root",V="./partials/",f=async(e,t)=>{let a=u(e);a.innerHTML="";try{let r=`${V}${t}`,o=await fetch(r,{method:"GET",headers:{"Content-Type":"text/html"}});if(!o.ok)throw new Error(`Could not load ${t}`);let n=await o.text();a.innerHTML=n}catch(r){console.error(r)}},O="state",$=()=>{try{let e=localStorage.getItem(O);return e===null?null:JSON.parse(e)}catch(e){return console.error("Failed to read from localStorage:",e),null}},k=e=>{try{localStorage.setItem(O,JSON.stringify(e))}catch{console.error("Failed to save to localStorage:",error)}};var D=e=>{let t,a=[],r=()=>Object.freeze(t),o=s=>{t=e(t,s),a.forEach(c=>c())},n=s=>(a.push(s),()=>{a=a.filter(c=>c!==s)});return o({type:"@@INIT"}),{getState:r,dispatch:o,subscribe:n}},p=Object.freeze({GAME:"GAME",NEW_GAME:"NEW_GAME"}),d=Object.freeze({CLEAR_GAME:"CLEAR_GAME",SET_GAME:"SET_GAME",CHANGE_SCREEN:"CHANGE_SCREEN",UPDATE_SCREEN:"UPDATE_SCREEN",TURN_ON:"TURN_ON",INCREASE_COUNT_WINNER:"INCREASE_COUNT_WINNER",NEXT_ROUND:"NEXT_ROUND",INIT:"@@INIT"}),T={turn:"X",board:["","","","","","","","",""],score:{you:0,ties:0,rival:0}},Z={game:{playerMark:"",rivalMark:"",vs:"",aiDifficult:""},screen:"",boardGame:T},W=(e=Z,t)=>{switch(t.type){case d.CLEAR_GAME:{let a=structuredClone(e),{screen:r}=t?.payload??{};return{...a,screen:r}}case d.CHANGE_SCREEN:{let a=structuredClone(e),{playerMark:r,vs:o,aiDifficult:n,screen:s,boardGame:c}=t.payload;return{...a,game:{playerMark:r,rivalMark:r===""?"":r==="X"?"O":"X",vs:o,aiDifficult:n},screen:s,boardGame:c}}case d.UPDATE_SCREEN:{let a=structuredClone(e),{screen:r}=t.payload;return{...a,screen:r}}case d.TURN_ON:{let a=structuredClone(e),{turn:r,idx:o}=t.payload,{boardGame:{board:n,score:s}}=a;return n[o]=r,{...a,boardGame:{turn:r==="X"?"O":"X",board:n,score:s}}}case d.INCREASE_COUNT_WINNER:{let a=structuredClone(e),{game:{playerMark:r},boardGame:{turn:o,board:n,score:{you:s,ties:c,rival:i}}}=a,{winner:l}=t.payload;return l==="TIE"?c++:r===l?s++:i++,{...a,boardGame:{turn:o,board:n,score:{you:s,ties:c,rival:i}}}}case d.NEXT_ROUND:{let a=structuredClone(e),{boardGame:{score:r}}=a;return{...a,boardGame:{turn:T.turn,board:T.board,score:r}}}case d.INIT:return{...$()??structuredClone(e)};default:return e}},U=(e,{screen:t})=>{e.dispatch({type:d.CLEAR_GAME,payload:{screen:t??""}})},I=e=>{e.dispatch({type:d.CHANGE_SCREEN,payload:{playerMark:"",vs:"",aiDifficult:"",screen:p.NEW_GAME,boardGame:T}})},M=(e,{playerMark:t,vs:a,aiDifficult:r})=>{e.dispatch({type:d.CHANGE_SCREEN,payload:{playerMark:t,vs:a,aiDifficult:r,screen:p.GAME,boardGame:T}})};var H=e=>{e.dispatch({type:d.INIT})},v=(e,{turn:t,idx:a})=>{e.dispatch({type:d.TURN_ON,payload:{turn:t,idx:a}})},P=(e,{winner:t})=>{e.dispatch({type:d.INCREASE_COUNT_WINNER,payload:{winner:t}})},X=e=>{e.dispatch({type:d.NEXT_ROUND})};var _=Object.freeze({X:"X",O:"O",TIE:"TIE"}),R=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],b=e=>{for(let[t,a,r]of R)if(e[t]&&e[t]===e[a]&&e[t]===e[r])return e[t];return e.includes("")?null:_.TIE},w=e=>{let t=e.map((r,o)=>r===""?o:null).filter(r=>r!==null);return t[Math.floor(Math.random()*t.length)]},F=(e,t=_.O,a=_.X)=>{for(let r of R){let[o,n,s]=r,c=[e[o],e[n],e[s]];if(c.filter(i=>i===t).length===2&&c.includes(""))return r[c.indexOf("")]}for(let r of R){let[o,n,s]=r,c=[e[o],e[n],e[s]];if(c.filter(i=>i===a).length===2&&c.includes(""))return r[c.indexOf("")]}return w(e)},Y=(e,t=_.O,a=_.X)=>{function r(o,n){let s=b(o);if(s!==null)return s===t?{score:1}:s===a?{score:-1}:{score:0};let c=[];for(let i=0;i<o.length;i++)if(o[i]===""){let l={};l.index=i,o[i]=n?t:a;let m=r(o,!n);l.score=m.score,o[i]="",c.push(l)}if(n){let i=-1/0,l;for(let m of c)m.score>i&&(i=m.score,l=m);return l}else{let i=1/0,l;for(let m of c)m.score<i&&(i=m.score,l=m);return l}}return r(e,!0).index};var g=Object.freeze({SELECT_DIFFICULT:"SELECT_DIFFICULT",RESTART_GAME:"RESTART_GAME",SHOW_WHO_WIN:"SHOW_WHO_WIN"}),G="#modal-dialog",y=u(G),B={[g.SHOW_WHO_WIN]:async({playerMark:e,vs:t,winner:a})=>{if(await f(G,"dialog-game-result.html"),u(`#dialog-game-result--title-${a.toLowerCase()}`).style.display="flex",a!==_.TIE){let o=u("#dialog-game-result--sub-title");e!==a?o.textContent=t==="AI"?"OH NO, YOU LOST...":"PLAYER 2 WINS!":o.textContent=t==="AI"?"YOU WON!":"PLAYER 1 WINS!",o.style.display="inline-block"}y.showModal();let r=E("#dialog-game-result button");return new Promise(o=>{r.forEach(n=>{n.addEventListener("click",async s=>{s.preventDefault();let c=s.target.getAttribute("data-answer");y.close(),o(c)})}),r[0].focus()})},[g.RESTART_GAME]:async e=>{await f(G,"dialog-restart-game.html"),y.showModal();let t=E("#dialog-restart-game button");return new Promise(a=>{t.forEach(r=>{r.addEventListener("click",o=>{o.preventDefault();let n=o.target.getAttribute("data-answer");y.close(),a(n)})}),t[0].focus()})},[g.SELECT_DIFFICULT]:async()=>(await f(G,"dialog-select-level-ai.html"),y.showModal(),new Promise(e=>{y.querySelectorAll(".dialog-select-level button").forEach(a=>{a.addEventListener("click",r=>{r.preventDefault();let o=r.target.getAttribute("data-level");y.close(),e(o)})})}))},S=async(e,...t)=>await B[e](...t);var ee="new-game.html";async function C({idRoot:e,store:t}){await f(e,ee),U(t,{prevScreen:p.NEW_GAME,screen:p.NEW_GAME});let a=E("input.player-option--radio-mark");a&&(a[0].checked=!0),[".new-game__choice--button-cpu",".new-game__choice--button-player"].forEach(r=>{u(r).addEventListener("click",async o=>{o.preventDefault();let n=o.target.getAttribute("data-vs"),s=u("input.player-option--radio-mark:checked").value;if(n==="PLAYER")M(t,{playerMark:s,vs:n,aiDifficult:""});else{let c=await S(g.SELECT_DIFFICULT);M(t,{playerMark:s,vs:n,aiDifficult:c})}})})}var te="game.html",j=e=>{let t=e.getState(),{boardGame:{turn:a}}=t,r=u("#game__header-turn .game__header-turn--who-plays"),o=u("#game-plays"),n=a==="X"?"game__header-turn--x":"game__header-turn--o",s=a==="X"?"game__header-turn--o":"game__header-turn--x",c=a==="X"?"turn-x":"turn-o",i=a==="X"?"turn-o":"turn-x";r.classList.add(n),r.classList.remove(s),o.classList.add(c),o.classList.remove(i)},q=e=>{let t=e.getState(),{boardGame:{score:{you:a,ties:r,rival:o}}}=t;u("#game__score--you .game__score--score").innerHTML=a,u("#game__score--ties .game__score--score").innerHTML=r,u("#game__score--rival .game__score--score").innerHTML=o},z=e=>{let t=e.getState(),{boardGame:{board:a}}=t;E("#game-plays .game__plays--button").forEach((o,n)=>{let s=Math.floor(n/3)+1,c=n%3+1,i=a[n];if(i==="")o.setAttribute("aria-pressed","false"),o.setAttribute("aria-label",`Row ${s}, Column ${c}. Empty`),o.classList.remove("play-o"),o.classList.remove("play-x"),o.removeAttribute("disabled");else{let l=i==="X"?"play-x":"play-o",m=i==="X"?"play-o":"play-x";o.classList.remove(m),o.classList.add(l),o.setAttribute("aria-pressed","true"),o.setAttribute("aria-label",`Row ${s}, Column ${c}. Turn ${i.toUpperCase()}`),o.disabled=!0}})},x=e=>{q(e),j(e),z(e),J(e)},J=async e=>{let t=e.getState(),{game:a,boardGame:{board:r}}=t,o=b(r);if(o){let{playerMark:n,vs:s,rivalMark:c}=a;P(e,{winner:o}),q(e),await new Promise(l=>setTimeout(l,500)),await S(g.SHOW_WHO_WIN,{playerMark:n,rivalMark:c,winner:o,vs:s})==="quit"?I(e):(X(e),x(e),L(e))}},L=async e=>{let t=e.getState(),{boardGame:a,game:r}=t,{aiDifficult:o,playerMark:n,vs:s,rivalMark:c}=r,{turn:i,board:l}=a;if(s!=="AI"||i!==c||b(l))return;let h=u("#thinking-robot");h.classList.add("thinking-robot--show");let A=null;switch(o){case"EASY":A=w(l);break;case"MEDIUM":A=F(l,c,n);break;case"HARD":A=Y(l,c,n);break}await new Promise(Q=>setTimeout(Q,500)),A!==null&&(v(e,{idx:A,turn:i}),x(e)),h.classList.remove("thinking-robot--show")};async function K({idRoot:e,store:t}){let a=t.getState(),{game:r}=a,{playerMark:o,vs:n,rivalMark:s}=r;await f(e,te),u("#game__score--you .game__score--title").innerHTML=n==="AI"?`${o} (YOU)`:`${o} (P1)`,u("#game__score--rival .game__score--title").innerHTML=n==="AI"?`${s} (CPU)`:`${s} (P2)`,u("#game__score--you").classList.add(o==="X"?"button--color-blue":"button--color-orange"),u("#game__score--rival").classList.add(o==="X"?"button--color-orange":"button--color-blue"),x(t),L(t),E(".game__plays--button").forEach((c,i)=>{c.addEventListener("click",async l=>{l.preventDefault();let m=t.getState(),{boardGame:{turn:h}}=m;v(t,{idx:i,turn:h}),j(t),z(t),J(t),L(t)})}),u("#game__header-restart--button").addEventListener("click",async c=>{c.preventDefault(),await S(g.RESTART_GAME)==="yes"&&I(t)})}(async()=>{let e=D(W),t="",a=async()=>{let n=e.getState(),{screen:s}=n;if(s===""){t=p.NEW_GAME,await C({idRoot:N,store:e});return}s!==t&&(t=s,s===p.NEW_GAME&&await C({idRoot:N,store:e}),s===p.GAME&&await K({idRoot:N,store:e}))},r=async()=>{let n=e.getState();k(n)};e.subscribe(a),e.subscribe(r),H(e),u("#modal-dialog").showModal||$dialogPolyfill.registerDialog(dialog)})();})();
